<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Video Page | Sundari Kanya</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .logo {
      font-size: 2rem;
      color: crimson;
      font-weight: bold;
    }

    .keywords a:hover {
      color: crimson;
      text-decoration: underline;
    }

    .outer-card {
      border: 1px solid #ccc;
      padding: 5px;
      height: 100%;
    }

    .inner-box {
      border: 2px solid #dc3545;
      display: flex;
      flex-direction: column;
      height: 320px;
      overflow: hidden;
      background: white;
    }

    .thumbnail-wrapper {
      flex: 1;
      overflow: hidden;
    }

    .thumb {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-title {
      height: 60px;
      padding: 5px 8px;
      font-size: 0.9rem;
      font-weight: 500;
      background-color: #fff;
      border-top: 1px solid #eee;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>

<!-- Header -->
<header class="bg-white shadow-sm p-3 mb-3">
  <div class="container-fluid d-flex justify-content-between align-items-center flex-wrap">
    <div class="logo">SUNDARI KANYA</div>
    <ul class="keywords list-inline mb-0">
      <li class="list-inline-item"><a href="#" class="text-decoration-none text-secondary">Indian Model</a></li>
      <li class="list-inline-item">|</li>
      <li class="list-inline-item"><a href="#" class="text-decoration-none text-secondary">Saree</a></li>
      <li class="list-inline-item">|</li>
      <li class="list-inline-item"><a href="#" class="text-decoration-none text-secondary">Bridal</a></li>
      <li class="list-inline-item">|</li>
      <li class="list-inline-item"><a href="#" class="text-decoration-none text-secondary">Style</a></li>
      <li class="list-inline-item">|</li>
      <li class="list-inline-item"><a href="#" class="text-decoration-none text-secondary">Beauty</a></li>
      <li class="list-inline-item">|</li>
      <li class="list-inline-item"><a href="#" class="text-decoration-none text-secondary">Fashion</a></li>
    </ul>
  </div>
</header>



<div class="container mb-4">
  <div class="row">
    <div class="col-lg-8 offset-lg-2">
      <div class="ratio ratio-16x9 mb-3">
        <video id="videoPlayer" controls class="w-100" style="max-height: 480px;">
          <source id="videoSource" src="" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
      <div class="d-flex justify-content-between mb-3">
        <button id="prevBtn" class="btn btn-outline-primary">&larr; Previous</button>
        <button id="nextBtn" class="btn btn-outline-primary">Next &rarr;</button>
      </div>

      <h4 class="fw-semibold" id="video-title">Loading title...</h4>
      <p class="text-muted" id="video-description">Loading description...</p>

      <p><strong>Tag:</strong> <span id="video-tags-container"></span></p>
      <p><strong>Category:</strong> <span id="video-categories-container"></span></p>
    </div>
  </div>
</div>

<!-- Suggested Videos -->
<div class="container mt-4">
  <h5 class="mb-3">Suggested Videos</h5>
  <div id="suggestedVideos" class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-3">
    <!-- Dynamic cards injected here -->
  </div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const currentId = params.get("id");

  if (!currentId) {
    document.body.innerHTML =
      "<h2 class='text-center text-danger mt-5'>Video ID not found in URL.</h2>";
  } else {
    const apiUrl = `https://sundarikanya.vercel.app/api/get/sundarikanya?id=${currentId}`;

    fetch(apiUrl)
      .then((res) => res.json())
      .then((currentVideo) => {
        if (!currentVideo || !currentVideo.videourl) {
          document.body.innerHTML =
            "<h2 class='text-center text-danger mt-5'>Video not found.</h2>";
          return;
        }

        // Fill static info
        document.getElementById("video-title").textContent =
          currentVideo.title || "Untitled";
        document.getElementById("video-description").textContent =
          currentVideo.description || "";

        // Handle tags
        const tagContainer = document.getElementById("video-tags-container");
        tagContainer.innerHTML = ""; // Clear existing
        (currentVideo.tag || []).forEach((tag) => {
          const tagBtn = document.createElement("a");
          tagBtn.href = `/tags/${encodeURIComponent(tag)}`;
          tagBtn.textContent = tag;
          tagBtn.className =
            "badge bg-primary text-white me-1 text-decoration-none";
          tagContainer.appendChild(tagBtn);
        });

        // Video player logic
        const videoUrls = Array.isArray(currentVideo.videourl)
          ? currentVideo.videourl
          : [currentVideo.videourl];
        const videoSource = document.getElementById("videoSource");
        const videoPlayer = document.getElementById("videoPlayer");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        let currentIndex = 0;

        function updateVideo(index) {
          videoSource.src = videoUrls[index];
          videoPlayer.load(); // does NOT autoplay
        }

        updateVideo(currentIndex);

        prevBtn.addEventListener("click", () => {
          if (currentIndex > 0) {
            currentIndex--;
            updateVideo(currentIndex);
          }
        });

        nextBtn.addEventListener("click", () => {
          if (currentIndex < videoUrls.length - 1) {
            currentIndex++;
            updateVideo(currentIndex);
          }
        });

        // Hide buttons if only one video
        if (videoUrls.length <= 1) {
          prevBtn.style.display = "none";
          nextBtn.style.display = "none";
        }

        // Call onVideoChange to update categories and suggestions
        onVideoChange(currentVideo);
      })
      .catch((error) => {
        console.error("Failed to load video:", error);
        document.body.innerHTML =
          "<h2 class='text-center text-danger mt-5'>Error loading video. Please try again.</h2>";
      });
  }

  // Called when current video data is loaded or changed
  function onVideoChange(currentVideo) {
    // Render categories dynamically
    const categoryContainer = document.getElementById(
      "video-categories-container"
    );
    categoryContainer.innerHTML = "";
    (currentVideo.category || []).forEach((category) => {
      const catBtn = document.createElement("a");
      catBtn.href = `/category/${encodeURIComponent(category)}`;
      catBtn.textContent = category;
      catBtn.className =
        "badge bg-success text-white me-1 text-decoration-none";
      categoryContainer.appendChild(catBtn);
    });

    // Pick the best category (first in list) for suggestions
    const bestCategory =
      currentVideo.category && currentVideo.category.length > 0
        ? currentVideo.category[0]
        : null;

    loadSuggestedVideos(bestCategory);
  }

  async function loadSuggestedVideos(category) {
    const container = document.getElementById("suggestedVideos");
    container.innerHTML = "<p>Loading suggested videos...</p>";

    if (!category) {
      container.innerHTML = "<p>No category available for suggestions.</p>";
      return;
    }

    try {
      const response = await fetch(
        `https://sundarikanya.vercel.app/api/get/sundarikanya1?category=${encodeURIComponent(
          category
        )}`
      );
      const data = await response.json();

      if (data.status === "success" && data.count > 0) {
        container.innerHTML = ""; // Clear existing cards

        data.data.forEach((video) => {
          const colDiv = document.createElement("div");
          colDiv.className = "col";

          colDiv.innerHTML = `
            <a href="video.html?id=${video.id}" class="text-decoration-none text-dark">
              <div class="outer-card">
                <div class="inner-box">
                  <div class="thumbnail-wrapper">
                    <img class="thumb" src="${video.thumbnail}" alt="Thumbnail" />
                  </div>
                  <div class="video-title">${video.title}</div>
                </div>
              </div>
            </a>
          `;

          container.appendChild(colDiv);
        });
      } else {
        container.innerHTML = "<p>No suggested videos found for this category.</p>";
      }
    } catch (error) {
      container.innerHTML = "<p>Error loading suggested videos.</p>";
      console.error(error);
    }
  }
</script>


</body>